<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="style.css"/>
</head>

<body>
    <video autoplay playsinline muted id="webcam" width="150" height="150"></video>
    <br><br>
    <div id="load_div">LOADING...</div>
    <br>
    <!-- <button id="pred_btn" disabled onclick="predict_value()">PREDICT</button><br><br> -->
    <div id="res" style="font-weight: bold; font-size: 40px;"></div>
    <script>
        var model, webcam;
        const webcamElement = document.getElementById('webcam');
        const initialise = async () => {
            model = await tf.loadLayersModel('tfjs_model/model.json');
            webcam = await tf.data.webcam(webcamElement, { facingMode: 'environment' });
            load_div.innerHTML = "Good to GO"
            //pred_btn.disabled = false;
            //const img = await webcam.capture()
            //console.log(img)

            setInterval(predict_value , 1000)

        };

        initialise();

        async function predict_value() {

            var image = tf.browser.fromPixels(webcamElement);  // for example

            prediction = model.predict(image.expandDims(0), { batchSize: 1 });

            val = (await prediction.array());
            // console.log(val)
            var valid = false;
            var j = 0;
            for (i = 1; i < val[0].length; i++) {
                if (val[0][i] > 0.9) valid = true;
                if (val[0][i] > val[0][j]) j = i;
            }
            var denom = ["10", "100", "20", "200", "2000", "50", "500"]
            if (valid)
                result = "Rs. " + denom[j]
            else
                result = "Cannot Predict"
            res.innerHTML = result;

        }

    </script>
</body>

</html>